(()=>{var t={"./src/lib/GIFEncoder.js":(t,e,i)=>{var r=i("./src/lib/TypedNeuQuant.js"),s=i("./src/lib/LZWEncoder.js");function o(){this.page=-1,this.pages=[],this.newPage()}o.pageSize=4096,o.charMap={};for(var n=0;n<256;n++)o.charMap[n]=String.fromCharCode(n);function a(t,e){this.width=~~t,this.height=~~e,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.neuQuant=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.dither=!1,this.globalPalette=!1,this.out=new o}o.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(o.pageSize),this.cursor=0},o.prototype.getData=function(){for(var t="",e=0;e<this.pages.length;e++)for(var i=0;i<o.pageSize;i++)t+=o.charMap[this.pages[e][i]];return t},o.prototype.writeByte=function(t){this.cursor>=o.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=t},o.prototype.writeUTFBytes=function(t){for(var e=t.length,i=0;i<e;i++)this.writeByte(t.charCodeAt(i))},o.prototype.writeBytes=function(t,e,i){for(var r=i||t.length,s=e||0;s<r;s++)this.writeByte(t[s])},a.prototype.setDelay=function(t){this.delay=Math.round(t/10)},a.prototype.setFrameRate=function(t){this.delay=Math.round(100/t)},a.prototype.setDispose=function(t){t>=0&&(this.dispose=t)},a.prototype.setRepeat=function(t){this.repeat=t},a.prototype.setTransparent=function(t){this.transparent=t},a.prototype.addFrame=function(t){this.image=t,this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null,this.getImagePixels(),this.analyzePixels(),!0===this.globalPalette&&(this.globalPalette=this.colorTab),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.globalPalette||this.writePalette(),this.writePixels(),this.firstFrame=!1},a.prototype.finish=function(){this.out.writeByte(59)},a.prototype.setQuality=function(t){t<1&&(t=1),this.sample=t},a.prototype.setDither=function(t){!0===t&&(t="FloydSteinberg"),this.dither=t},a.prototype.setGlobalPalette=function(t){this.globalPalette=t},a.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette},a.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")},a.prototype.analyzePixels=function(){this.colorTab||(this.neuQuant=new r(this.pixels,this.sample),this.neuQuant.buildColormap(),this.colorTab=this.neuQuant.getColormap()),this.dither?this.ditherPixels(this.dither.replace("-serpentine",""),null!==this.dither.match(/-serpentine/)):this.indexPixels(),this.pixels=null,this.colorDepth=8,this.palSize=7,null!==this.transparent&&(this.transIndex=this.findClosest(this.transparent,!0))},a.prototype.indexPixels=function(t){var e=this.pixels.length/3;this.indexedPixels=new Uint8Array(e);for(var i=0,r=0;r<e;r++){var s=this.findClosestRGB(255&this.pixels[i++],255&this.pixels[i++],255&this.pixels[i++]);this.usedEntry[s]=!0,this.indexedPixels[r]=s}},a.prototype.ditherPixels=function(t,e){var i={FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[.25,1,1]],FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]};if(!t||!i[t])throw"Unknown dithering kernel: "+t;var r=i[t],s=0,o=this.height,n=this.width,a=this.pixels,h=e?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var l=0;l<o;l++){e&&(h*=-1);for(var u=1==h?0:n-1,p=1==h?n:0;u!==p;u+=h){var f=3*(s=l*n+u),c=a[f],y=a[f+1],w=a[f+2];f=this.findClosestRGB(c,y,w),this.usedEntry[f]=!0,this.indexedPixels[s]=f,f*=3;for(var d=c-this.colorTab[f],g=y-this.colorTab[f+1],b=w-this.colorTab[f+2],x=1==h?0:r.length-1,v=1==h?r.length:0;x!==v;x+=h){var P=r[x][1],m=r[x][2];if(P+u>=0&&P+u<n&&m+l>=0&&m+l<o){var B=r[x][0];f=s+P+m*n,a[f*=3]=Math.max(0,Math.min(255,a[f]+d*B)),a[f+1]=Math.max(0,Math.min(255,a[f+1]+g*B)),a[f+2]=Math.max(0,Math.min(255,a[f+2]+b*B))}}}}},a.prototype.findClosest=function(t,e){return this.findClosestRGB((16711680&t)>>16,(65280&t)>>8,255&t,e)},a.prototype.findClosestRGB=function(t,e,i,r){if(null===this.colorTab)return-1;if(this.neuQuant&&!r)return this.neuQuant.lookupRGB(t,e,i);for(var s=0,o=16777216,n=this.colorTab.length,a=0,h=0;a<n;h++){var l=t-(255&this.colorTab[a++]),u=e-(255&this.colorTab[a++]),p=i-(255&this.colorTab[a++]),f=l*l+u*u+p*p;(!r||this.usedEntry[h])&&f<o&&(o=f,s=h)}return s},a.prototype.getImagePixels=function(){var t=this.width,e=this.height;this.pixels=new Uint8Array(t*e*3);for(var i=this.image,r=0,s=0,o=0;o<e;o++)for(var n=0;n<t;n++)this.pixels[s++]=i[r++],this.pixels[s++]=i[r++],this.pixels[s++]=i[r++],r++},a.prototype.writeGraphicCtrlExt=function(){var t,e;this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4),null===this.transparent?(t=0,e=0):(t=1,e=2),this.dispose>=0&&(e=7&this.dispose),e<<=2,this.out.writeByte(0|e|t),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},a.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame||this.globalPalette?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},a.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},a.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},a.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var t=768-this.colorTab.length,e=0;e<t;e++)this.out.writeByte(0)},a.prototype.writeShort=function(t){this.out.writeByte(255&t),this.out.writeByte(t>>8&255)},a.prototype.writePixels=function(){new s(this.width,this.height,this.indexedPixels,this.colorDepth).encode(this.out)},a.prototype.stream=function(){return this.out},t.exports=a},"./src/lib/LZWEncoder.js":t=>{var e=-1,i=12,r=5003,s=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];t.exports=function(t,o,n,a){var h,l,u,p,f,c,y=Math.max(2,a),w=new Uint8Array(256),d=new Int32Array(r),g=new Int32Array(r),b=0,x=0,v=!1;function P(t,e){w[l++]=t,l>=254&&S(e)}function m(t){B(r),x=f+2,v=!0,M(f,t)}function B(t){for(var e=0;e<t;++e)d[e]=-1}function S(t){l>0&&(t.writeByte(l),t.writeBytes(w,0,l),l=0)}function T(t){return(1<<t)-1}function F(){return 0===remaining?e:(--remaining,255&n[curPixel++])}function M(t,e){for(h&=s[b],b>0?h|=t<<b:h=t,b+=n_bits;b>=8;)P(255&h,e),h>>=8,b-=8;if((x>u||v)&&(v?(u=T(n_bits=p),v=!1):(++n_bits,u=n_bits==i?1<<i:T(n_bits))),t==c){for(;b>0;)P(255&h,e),h>>=8,b-=8;S(e)}}this.encode=function(s){s.writeByte(y),remaining=t*o,curPixel=0,function(t,s){var o,n,a,h,y,w,b;for(p=t,v=!1,n_bits=p,u=T(n_bits),c=1+(f=1<<t-1),x=f+2,l=0,h=F(),b=0,o=r;o<65536;o*=2)++b;b=8-b,B(w=r),M(f,s);t:for(;(n=F())!=e;)if(o=(n<<i)+h,d[a=n<<b^h]!==o){if(d[a]>=0){y=w-a,0===a&&(y=1);do{if((a-=y)<0&&(a+=w),d[a]===o){h=g[a];continue t}}while(d[a]>=0)}M(h,s),h=n,x<1<<i?(g[a]=x++,d[a]=o):m(s)}else h=g[a];M(h,s),M(c,s)}(y+1,s),s.writeByte(0)}}},"./src/lib/TypedNeuQuant.js":t=>{var e=100,i=256,r=i-1,s=4,o=16,n=1<<o,a=10,h=10,l=n>>h,u=n<<a-h,p=6,f=(i>>3)*(1<<p),c=30,y=1024,w=256,d=1<<18,g=499,b=491,x=487,v=503,P=3*v;t.exports=function(t,m){var B,S,T,F,M;function A(t,e,i,r,s){B[e][0]-=t*(B[e][0]-i)/y,B[e][1]-=t*(B[e][1]-r)/y,B[e][2]-=t*(B[e][2]-s)/y}function C(t,e,r,s,o){for(var n,a,h=Math.abs(e-t),l=Math.min(e+t,i),u=e+1,p=e-1,f=1;u<l||p>h;)a=M[f++],u<l&&((n=B[u++])[0]-=a*(n[0]-r)/d,n[1]-=a*(n[1]-s)/d,n[2]-=a*(n[2]-o)/d),p>h&&((n=B[p--])[0]-=a*(n[0]-r)/d,n[1]-=a*(n[1]-s)/d,n[2]-=a*(n[2]-o)/d)}function I(t,e,r){var n,p,f,c,y,w=~(1<<31),d=w,g=-1,b=g;for(n=0;n<i;n++)p=B[n],(f=Math.abs(p[0]-t)+Math.abs(p[1]-e)+Math.abs(p[2]-r))<w&&(w=f,g=n),(c=f-(T[n]>>o-s))<d&&(d=c,b=n),y=F[n]>>h,F[n]-=y,T[n]+=y<<a;return F[g]+=l,T[g]-=u,b}this.buildColormap=function(){!function(){var t,e;for(B=[],S=new Int32Array(256),T=new Int32Array(i),F=new Int32Array(i),M=new Int32Array(i>>3),t=0;t<i;t++)e=(t<<s+8)/i,B[t]=new Float64Array([e,e,e,0]),F[t]=n/i,T[t]=0}(),function(){var i,r,o,n,a,h,l=t.length,u=30+(m-1)/3,d=l/(3*m),B=~~(d/e),S=y,T=f,F=T>>p;for(F<=1&&(F=0),i=0;i<F;i++)M[i]=S*((F*F-i*i)*w/(F*F));l<P?(m=1,r=3):r=l%g!=0?3*g:l%b!=0?3*b:l%x!=0?3*x:3*v;var G=0;for(i=0;i<d;)if(A(S,h=I(o=(255&t[G])<<s,n=(255&t[G+1])<<s,a=(255&t[G+2])<<s),o,n,a),0!==F&&C(F,h,o,n,a),(G+=r)>=l&&(G-=l),0===B&&(B=1),++i%B==0)for(S-=S/u,(F=(T-=T/c)>>p)<=1&&(F=0),h=0;h<F;h++)M[h]=S*((F*F-h*h)*w/(F*F))}(),function(){for(var t=0;t<i;t++)B[t][0]>>=s,B[t][1]>>=s,B[t][2]>>=s,B[t][3]=t}(),function(){var t,e,s,o,n,a,h=0,l=0;for(t=0;t<i;t++){for(n=t,a=(s=B[t])[1],e=t+1;e<i;e++)(o=B[e])[1]<a&&(n=e,a=o[1]);if(o=B[n],t!=n&&(e=o[0],o[0]=s[0],s[0]=e,e=o[1],o[1]=s[1],s[1]=e,e=o[2],o[2]=s[2],s[2]=e,e=o[3],o[3]=s[3],s[3]=e),a!=h){for(S[h]=l+t>>1,e=h+1;e<a;e++)S[e]=t;h=a,l=t}}for(S[h]=l+r>>1,e=h+1;e<256;e++)S[e]=r}()},this.getColormap=function(){for(var t=[],e=[],r=0;r<i;r++)e[B[r][3]]=r;for(var s=0,o=0;o<i;o++){var n=e[o];t[s++]=B[n][0],t[s++]=B[n][1],t[s++]=B[n][2]}return t},this.lookupRGB=function(t,e,r){for(var s,o,n,a=1e3,h=-1,l=S[e],u=l-1;l<i||u>=0;)l<i&&((n=(o=B[l])[1]-e)>=a?l=i:(l++,n<0&&(n=-n),(s=o[0]-t)<0&&(s=-s),(n+=s)<a&&((s=o[2]-r)<0&&(s=-s),(n+=s)<a&&(a=n,h=o[3])))),u>=0&&((n=e-(o=B[u])[1])>=a?u=-1:(u--,n<0&&(n=-n),(s=o[0]-t)<0&&(s=-s),(n+=s)<a&&((s=o[2]-r)<0&&(s=-s),(n+=s)<a&&(a=n,h=o[3]))));return h}}}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,i),o.exports}(()=>{const t=i("./src/lib/GIFEncoder.js");self.onmessage=(e=>(function(e){const i=new t(e.width,e.height);0===e.index?i.writeHeader():i.firstFrame=!1,i.setTransparent(e.transparent),i.setDispose(e.dispose),i.setRepeat(e.repeat),i.setDelay(e.delay),i.setQuality(e.quality),i.setDither(e.dither),i.setGlobalPalette(e.globalPalette),i.addFrame(e.data),e.last&&i.finish(),!0===e.globalPalette&&(e.globalPalette=i.getGlobalPalette());const r=i.stream();if(e.data=r.pages,e.cursor=r.cursor,e.pageSize=r.constructor.pageSize,e.canTransfer){const t=Array.from(e.data).map(t=>t.buffer);return self.postMessage(e,t)}return self.postMessage(e)})(e.data))})()})();